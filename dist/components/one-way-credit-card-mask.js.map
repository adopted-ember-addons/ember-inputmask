{"version":3,"file":"one-way-credit-card-mask.js","sources":["../../src/components/one-way-credit-card-mask.gts"],"sourcesContent":["import Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\nimport { next } from '@ember/runloop';\nimport { isBlank } from '@ember/utils';\nimport { modifier } from 'ember-modifier';\nimport OneWayInputMask from './one-way-input-mask.gts';\nimport type { OneWayInputMaskSignature } from './one-way-input-mask.gts';\n\nexport interface OneWayCreditCardMaskSignature extends OneWayInputMaskSignature {\n  Args: OneWayInputMaskSignature['Args'] & {\n    separator?: string;\n    update?: (\n      unmaskedValue: string,\n      maskedValue: string,\n      cardType: string,\n    ) => void;\n  };\n}\n\n/**\n * Credit card mask component\n */\nexport default class OneWayCreditCardMask extends Component<OneWayCreditCardMaskSignature> {\n  @tracked private cardType: string = 'Other';\n  private inputElement?: HTMLInputElement;\n  private _resetMaskForPasteValue?: string;\n\n  setupInputModifier = modifier((element: HTMLInputElement) => {\n    this.inputElement = element;\n  });\n\n  get separator() {\n    return this.args.separator ?? '-';\n  }\n\n  get mask() {\n    const s = this.separator;\n\n    if (this.cardType === 'American Express') {\n      return `9999${s}999999${s}99999`;\n    }\n\n    if (this.cardType === 'Diners Club') {\n      return `9999${s}999999${s}9999`;\n    }\n\n    return `9999${s}9999${s}9999${s}9999`;\n  }\n\n  get mergedOptions() {\n    return Object.assign(\n      {},\n      {\n        onBeforePaste: (value: string) => this.handleBeforePaste(value),\n      },\n      this.args.options,\n    );\n  }\n\n  private handleBeforePaste = (value: string): string => {\n    const cardType = this.determineCardType(value);\n    this.cardType = cardType;\n\n    this._resetMaskForPasteValue = value;\n    // eslint-disable-next-line ember/no-runloop -- Required for Ember 5.8/5.12 compatibility\n    next(this._resetMaskForPasteCallback);\n\n    return value;\n  };\n\n  private _resetMaskForPasteCallback = (): void => {\n    if (this._resetMaskForPasteValue !== undefined) {\n      this.resetMaskForPaste(this._resetMaskForPasteValue);\n      this._resetMaskForPasteValue = undefined;\n    }\n  };\n\n  resetMaskForPaste = (value: string): void => {\n    if (!this.inputElement) return;\n\n    // We need to reset the value in case the mask was too small before and characters were cut off\n    this.inputElement.inputmask?.setValue(value);\n\n    // We need to update the parent component with the new pasted values\n    const unmaskedValue = this.inputElement.inputmask?.unmaskedvalue() ?? '';\n    this.sendUpdate(unmaskedValue, this.inputElement.value);\n  };\n\n  sendUpdate = (unmaskedValue: string, value: string): void => {\n    const cardType = this.determineCardType(unmaskedValue);\n    this.cardType = cardType;\n    this.args.update?.(unmaskedValue, value, cardType);\n  };\n\n  private determineCardType(unmaskedValue: string): string {\n    if (isBlank(unmaskedValue)) {\n      return 'Other';\n    }\n\n    if (unmaskedValue.match(/^4/)) {\n      return 'Visa';\n    }\n\n    if (unmaskedValue.match(/^5[1-5]/)) {\n      return 'MasterCard';\n    }\n\n    if (unmaskedValue.match(/^3[47]/)) {\n      return 'American Express';\n    }\n\n    if (unmaskedValue.match(/^3(?:0[0-5]|[68])/)) {\n      return 'Diners Club';\n    }\n\n    if (unmaskedValue.match(/^6(?:011|5)/)) {\n      return 'Discover';\n    }\n\n    if (unmaskedValue.match(/^(?:2131|1800|35)/)) {\n      return 'JCB';\n    }\n\n    return 'Other';\n  }\n\n  <template>\n    <OneWayInputMask\n      @mask={{this.mask}}\n      @value={{@value}}\n      @update={{this.sendUpdate}}\n      @options={{this.mergedOptions}}\n      @type={{@type}}\n      @onenter={{@onenter}}\n      @onescape={{@onescape}}\n      {{this.setupInputModifier}}\n      ...attributes\n    />\n  </template>\n}\n"],"names":["OneWayCreditCardMask","Component","g","prototype","tracked","i","void 0","inputElement","_resetMaskForPasteValue","setupInputModifier","modifier","element","separator","args","mask","s","cardType","mergedOptions","Object","assign","onBeforePaste","value","handleBeforePaste","options","determineCardType","next","_resetMaskForPasteCallback","undefined","resetMaskForPaste","inputmask","setValue","unmaskedValue","unmaskedvalue","sendUpdate","update","isBlank","match","setComponentTemplate","precompileTemplate","strictMode","scope","OneWayInputMask"],"mappings":"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"}